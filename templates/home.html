{% extends "base.html" %}


{% block title%}Home{% endblock %}

{% block body %}
<h1>Your To-Dos</h1>
<br>

<ul class="list-group list-group-flush">
    {% for task in user.tasks %}
    {% if task.status == "incomplete" %}

    <!-- Fix this issues vs keeping button outside of <li> -->
    <div class="container d-flex">
        <li class="list-group-item task" data-task_id="{{ task.id }}">{{ task.task }}
            <button class="complete">
                <span aria-hidden="true">&#x2713;</span>
            </button>
            <button class="delete">
                <span aria-hidden="true">&times;</span>
            </button>
        </li>
    </div>
    {% endif %}
    {% endfor %}
</ul>


<br>

<form method="post">
        <div class="container d-flex">
            <input autocomplete="off" autofocus class="form-control task-input" name="task" placeholder="Task" size="20" type="text">
            <button type="submit" class="btn btn-primary" type="submit">Add</button>

        </div>
</form>

<br>
<h3>Completed</h3>
<ul class="list-group list-group-flush" id="completed-tasks">
    {% for task in user.tasks %}
    {% if task.status == "complete" %}
    <div class="container d-flex">
        <li class="list-group-item task" data-task_id="{{ task.id }}">{{ task.task }}
            <button class="delete">
                <span aria-hidden="true">&times;</span>
            </button>
        </li>
    </div>
    {% endif %}
    {% endfor %}
</ul>

<script> 
    document.querySelectorAll('.delete').forEach(button => {
        button.addEventListener('click', function() {
            const taskId = this.parentElement.getAttribute('data-task_id');
            fetch('/delete-task', {
                method: 'DELETE',
                body: JSON.stringify({ id: taskId }),
                headers: { 'Content-Type': 'application/json' }
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                if (data.success) {
                    this.parentElement.remove();
                }
            });
        });
    });
</script>

<script>
    document.querySelectorAll('.complete').forEach(button => {
        button.addEventListener('click', function() {
            const taskId = this.parentElement.getAttribute('data-task_id');
            fetch('/mark-complete', {
                method: 'PUT',
                body: JSON.stringify({ id: taskId }),
                headers: { 'Content-Type': 'application/json' }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // this.parentElement.classList.add('completed');
                    const completedSection = document.querySelector('#completed-tasks');
                    completedSection.appendChild(this.parentElement);
                    // this.style.display = 'none'; // Hide the button
                    this.remove();
                }
            });
        });
    });
</script>

{% endblock %}






<!-- <div class="container d-flex">
    <li class="list-group-item tasks">{{ task.task }}
        <button class="mark-complete">
            <span aria-hidden="true">&#x2713;</span>
        </button>
        <button class="delete-button" onclick="deleteTask({{ task.id }})">
            <span aria-hidden="true">&times;</span>
        </button>
    </li> -->